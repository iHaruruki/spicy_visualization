<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>スナック評価</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>スナック評価</h1>
    
    <form id="snackForm">
        <h2>スナックの評価方法を選択</h2>
        <label><input type="radio" name="method" value="manual" checked> スナック名を入力</label>
        <label><input type="radio" name="method" value="ocr"> 画像ファイルをアップロード</label>
        
        <div id="manualInput">
            <label for="snackName">スナック名:</label>
            <input type="text" id="snackName"><br>
        </div>
        
        <div id="ocrInput" style="display:none;">
            <label for="snackImage">スナックの画像をアップロード:</label>
            <input type="file" id="snackImage" accept="image/*"><br>
        </div>
        
        <button type="submit">評価</button>
    </form>
    
    <h2>評価結果</h2>
    <p id="evaluation"></p>
    
    <script>
        $(document).ready(function() {
    // 疑似データベース（CSVの代わり）
    let snackData = {
        "辛口スナックA": 3,
        "激辛スナックB": 5,
        "マイルドスナック": 1
    };

    // spicy_tolerance.html で入力したデータを取得
    let age = localStorage.getItem('userAge') || "未入力";
    let nationality = localStorage.getItem('userNationality') || "未入力";
    let finalTolerance = localStorage.getItem('finalTolerance') || "未計算";

    // 国籍の表示名を修正
    let nationalityText = (nationality === "japan") ? "日本" : (nationality === "thailand") ? "タイ" : nationality;

    // データを画面に表示
    $('#evaluation').before(`
        <h2>ユーザー情報</h2>
        <p>年齢: ${age} 歳</p>
        <p>国籍: ${nationality}</p>
        <p>計算された許容辛さレベル: ${finalTolerance}</p>
    `);

    $('input[name="method"]').change(function() {
        if ($(this).val() === "manual") {
            $('#manualInput').show();
            $('#ocrInput').hide();
        } else {
            $('#manualInput').hide();
            $('#ocrInput').show();
        }
    });

    $('#snackForm').submit(function(event) {
        event.preventDefault();
        let method = $('input[name="method"]:checked').val();
        let snackName = "";

        if (method === "manual") {
            snackName = $('#snackName').val().trim();
        } else {
            alert("OCR機能は未実装です。");
            return;
        }

        let spiciness = snackData[snackName] || null;
        if (spiciness === null) {
            $('#evaluation').text(`「${snackName}」のデータが見つかりません。`);
            return;
        }

        let userTolerance = parseFloat(finalTolerance);
        let resultMessage = `「${snackName}」の辛さレベルは ${spiciness} です。`;

        if (spiciness > userTolerance) {
            resultMessage += "このスナックは辛すぎるかもしれません！";
        } else {
            resultMessage += "このスナックはあなたに合いそうです！";
        }

        $('#evaluation').text(resultMessage);
    });
});

    </script>
    